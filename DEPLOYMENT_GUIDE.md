# دليل تشغيل نظام Adalalegalis

## المتطلبات الأساسية

قبل البدء في تشغيل النظام، تأكد من تثبيت البرامج التالية:

- Docker (الإصدار 20.10.0 أو أحدث)
- Docker Compose (الإصدار 2.0.0 أو أحدث)
- Git (اختياري، للحصول على التحديثات المستقبلية)

## خطوات التشغيل

### 1. تحضير الملفات

1. قم بفك ضغط حزمة `adalalegalis_final_package.tar.gz` في المجلد المطلوب:
   ```bash
   tar -xzf adalalegalis_final_package.tar.gz
   cd adalalegalis_final
   ```

### 2. تكوين المتغيرات البيئية (اختياري)

1. يمكنك تعديل ملف `.env` في المجلد الرئيسي لتخصيص إعدادات النظام:
   ```bash
   cp .env.example .env
   nano .env
   ```

2. قم بتعديل المتغيرات البيئية حسب احتياجاتك، مثل كلمات المرور وإعدادات قاعدة البيانات.

### 3. بناء وتشغيل الحاويات

1. قم ببناء وتشغيل جميع الحاويات باستخدام Docker Compose:
   ```bash
   docker-compose up -d
   ```

2. انتظر حتى يتم بناء وتشغيل جميع الحاويات. قد يستغرق هذا بضع دقائق في المرة الأولى.

3. تحقق من حالة الحاويات للتأكد من أنها تعمل بشكل صحيح:
   ```bash
   docker-compose ps
   ```

### 4. إعداد قاعدة البيانات

1. سيتم إنشاء قاعدة البيانات تلقائيًا عند بدء تشغيل الحاويات.

2. لتهيئة قاعدة البيانات بالجداول والبيانات الأولية، قم بتنفيذ:
   ```bash
   docker-compose exec backend npm run db:migrate
   docker-compose exec backend npm run db:seed
   ```

### 5. إنشاء حساب المسؤول

1. قم بتنفيذ سكريبت إنشاء حساب المسؤول:
   ```bash
   docker-compose exec backend node setup_admin_user.js
   ```

2. سيتم إنشاء حساب مسؤول بالبيانات التالية:
   - البريد الإلكتروني: ezoo.91.91@gmail.com
   - كلمة المرور: admin123
   - الدور: مسؤول النظام (admin)

### 6. الوصول إلى النظام

1. يمكنك الوصول إلى واجهة المستخدم الرئيسية من خلال المتصفح على العنوان:
   ```
   http://localhost:4200
   ```

2. قم بتسجيل الدخول باستخدام بيانات حساب المسؤول:
   - البريد الإلكتروني: ezoo.91.91@gmail.com
   - كلمة المرور: admin123

3. يمكنك الوصول إلى واجهة برمجة التطبيقات (API) على العنوان:
   ```
   http://localhost:3000
   ```

4. يمكنك الوصول إلى خدمة الذكاء الاصطناعي على العنوان:
   ```
   http://localhost:5000
   ```

## إدارة النظام

### إيقاف النظام

لإيقاف تشغيل النظام مع الاحتفاظ بالبيانات:
```bash
docker-compose down
```

### إعادة تشغيل النظام

لإعادة تشغيل النظام بعد إيقافه:
```bash
docker-compose up -d
```

### عرض السجلات

لعرض سجلات جميع الحاويات:
```bash
docker-compose logs
```

لعرض سجلات حاوية محددة (مثل الواجهة الأمامية):
```bash
docker-compose logs frontend
```

لعرض السجلات بشكل مستمر:
```bash
docker-compose logs -f
```

## استكشاف الأخطاء وإصلاحها

### مشكلة في الاتصال بقاعدة البيانات

1. تأكد من أن حاوية قاعدة البيانات تعمل:
   ```bash
   docker-compose ps postgres
   ```

2. تحقق من سجلات قاعدة البيانات:
   ```bash
   docker-compose logs postgres
   ```

3. تأكد من صحة إعدادات الاتصال في ملف `.env`.

### مشكلة في الواجهة الأمامية

1. تحقق من سجلات الواجهة الأمامية:
   ```bash
   docker-compose logs frontend
   ```

2. تأكد من أن الخادم الخلفي يعمل بشكل صحيح.

3. امسح ذاكرة التخزين المؤقت للمتصفح وأعد تحميل الصفحة.

### مشكلة في الخادم الخلفي

1. تحقق من سجلات الخادم الخلفي:
   ```bash
   docker-compose logs backend
   ```

2. تأكد من صحة إعدادات الاتصال بقاعدة البيانات.

3. أعد تشغيل حاوية الخادم الخلفي:
   ```bash
   docker-compose restart backend
   ```

### مشكلة في خدمة الذكاء الاصطناعي

1. تحقق من سجلات خدمة الذكاء الاصطناعي:
   ```bash
   docker-compose logs ml-service
   ```

2. تأكد من تحميل النماذج بشكل صحيح.

3. أعد تشغيل حاوية خدمة الذكاء الاصطناعي:
   ```bash
   docker-compose restart ml-service
   ```

## تحديث النظام

عند توفر تحديث جديد للنظام:

1. قم بإيقاف النظام:
   ```bash
   docker-compose down
   ```

2. قم بتحديث الملفات بالإصدار الجديد.

3. أعد بناء وتشغيل الحاويات:
   ```bash
   docker-compose up -d --build
   ```

4. قم بتحديث قاعدة البيانات إذا لزم الأمر:
   ```bash
   docker-compose exec backend npm run db:migrate
   ```

## النسخ الاحتياطي واستعادة البيانات

### إنشاء نسخة احتياطية

لإنشاء نسخة احتياطية من قاعدة البيانات:
```bash
docker-compose exec postgres pg_dump -U postgres adalalegalis > backup_$(date +%Y%m%d).sql
```

### استعادة النسخة الاحتياطية

لاستعادة قاعدة البيانات من نسخة احتياطية:
```bash
cat backup_file.sql | docker-compose exec -T postgres psql -U postgres adalalegalis
```

## ملاحظات هامة

- تم تكوين النظام للعمل في بيئة تطوير افتراضية. للإنتاج، يجب تعديل الإعدادات الأمنية وكلمات المرور.
- يجب تغيير كلمة مرور المسؤول الافتراضية بعد تسجيل الدخول لأول مرة.
- تأكد من إجراء نسخ احتياطي منتظم لقاعدة البيانات.
- للحصول على الدعم الفني، يرجى التواصل مع فريق Adalalegalis على support@adalalegalis.com.
